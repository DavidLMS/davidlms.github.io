<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Práctica Wireguard.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="wireguard-en-ubuntu-server-20.04"><a name="wireguard-en-ubuntu-server-20.04" href="#wireguard-en-ubuntu-server-20.04"></a>WireGuard en Ubuntu Server 20.04</h1><p><img src="images/diagrama.png" alt="Diagrama propuesto para la práctica" width="600"></p><p><strong>Nota importante 1</strong>: Para seguir esta guía necesitas que el servidor que vayas a utilizar tenga una IP pública. Como es poco habitual que esto ocurra en un entorno de prácticas, tienes la opción de configurar un reenvío de puerto.<br>Si lo haces en tu casa, configura en tu router que el puerto 51820 sea redirigido al puerto 51820 de la IP local de tu servidor.<br>Si lo haces en un aula, pide a tu instructor que lo haga cuando quieras hacer la prueba de conexión.<br>Si no fuera posible ninguna de las opciones anteriores, quizás puedas alquilar un servidor público para hacer la prueba. Por ejemplo, servicios en la nube como AWS y Azure ofrecen cuentas con créditos gratuitos para estudiantes.</p><p><strong>Nota importante 2</strong>: Durante la guía, todos los parámetros que haya que sustituir se mostrarán entre corchetes. Por ejemplo, si la IP de tu servidor es 192.168.1.100 y en el comando aparece [IP_SERVIDOR]:</p><pre><code data-origin="<pre><code>ping [IP_SERVIDOR]
</code></pre>">ping [IP_SERVIDOR]
</code></pre><p>Tendrás que sustituirlo por tu parámetro sin incluir los corchetes. Por ejemplo:</p><pre><code data-origin="<pre><code>ping 192.168.1.100
</code></pre>">ping 192.168.1.100
</code></pre><h1 id="tabla-de-contenidos"><a name="tabla-de-contenidos" href="#tabla-de-contenidos"></a>Tabla de contenidos</h1><p class="toc" style="undefined"></p><ul>
<li><ul>
<li><span class="title">
<a href="#1---configurar-un-servidor-vpn-con-wireguard-en-ubuntu-server" title="1 - Configurar un servidor VPN con WireGuard en Ubuntu Server">1 - Configurar un servidor VPN con WireGuard en Ubuntu Server</a>
</span>
<!--span class="number">
0
</span-->
<ul>
<li><span class="title">
<a href="#1.1---actualización-del-servidor" title="1.1 - Actualización del servidor">1.1 - Actualización del servidor</a>
</span>
<!--span class="number">
1
</span-->
</li>
<li><span class="title">
<a href="#1.2---instalar-ssh-para-acceder-remotamente-al-servidor-(opcional)" title="1.2 - Instalar SSH para acceder remotamente al servidor (opcional)">1.2 - Instalar SSH para acceder remotamente al servidor (opcional)</a>
</span>
<!--span class="number">
2
</span-->
</li>
<li><span class="title">
<a href="#1.3---instalar-el-servidor-vpn-wireguard" title="1.3 - Instalar el servidor VPN WireGuard">1.3 - Instalar el servidor VPN WireGuard</a>
</span>
<!--span class="number">
3
</span-->
</li>
<li><span class="title">
<a href="#1.4---generar-las-claves-del-servidor" title="1.4 - Generar las claves del servidor">1.4 - Generar las claves del servidor</a>
</span>
<!--span class="number">
4
</span-->
</li>
<li><span class="title">
<a href="#1.5---determinar-la-interfaz-predeterminada" title="1.5 - Determinar la interfaz predeterminada">1.5 - Determinar la interfaz predeterminada</a>
</span>
<!--span class="number">
5
</span-->
</li>
<li><span class="title">
<a href="#1.6---configurar-la-interfaz-para-wireguard" title="1.6 - Configurar la interfaz para WireGuard">1.6 - Configurar la interfaz para WireGuard</a>
</span>
<!--span class="number">
6
</span-->
</li>
<li><span class="title">
<a href="#1.7---establecer-los-permisos-de-acceso-a-la-clave-privada-y-a-la-configuración" title="1.7 - Establecer los permisos de acceso a la clave privada y a la configuración">1.7 - Establecer los permisos de acceso a la clave privada y a la configuración</a>
</span>
<!--span class="number">
7
</span-->
</li>
<li><span class="title">
<a href="#1.8---encender-la-interfaz-de-wireguard" title="1.8 - Encender la interfaz de WireGuard">1.8 - Encender la interfaz de WireGuard</a>
</span>
<!--span class="number">
8
</span-->
</li>
<li><span class="title">
<a href="#1.9---iniciar-la-interfaz-de-wireguard-automáticamente-al-arrancar" title="1.9 - Iniciar la interfaz de WireGuard automáticamente al arrancar">1.9 - Iniciar la interfaz de WireGuard automáticamente al arrancar</a>
</span>
<!--span class="number">
9
</span-->
</li>
<li><span class="title">
<a href="#1.10---configurando-el-tráfico-de-red-y-el-cortafuegos" title="1.10 - Configurando el tráfico de red y el cortafuegos">1.10 - Configurando el tráfico de red y el cortafuegos</a>
</span>
<!--span class="number">
10
</span-->
<ul>
<li><span class="title">
<a href="#1.10.1---permitir-el-reenvío-de-tráfico" title="1.10.1 - Permitir el reenvío de tráfico">1.10.1 - Permitir el reenvío de tráfico</a>
</span>
<!--span class="number">
11
</span-->
</li>
<li><span class="title">
<a href="#1.10.2---abrir-el-puerto-de-wireguard-y-activar-el-cortafuegos-(opcional)" title="1.10.2 - Abrir el puerto de WireGuard y activar el cortafuegos (opcional)">1.10.2 - Abrir el puerto de WireGuard y activar el cortafuegos (opcional)</a>
</span>
<!--span class="number">
12
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#1.11---añadiendo-clientes" title="1.11 - Añadiendo clientes">1.11 - Añadiendo clientes</a>
</span>
<!--span class="number">
13
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#2---configurar-un-cliente-móvil-en-el-servidor-wireguard" title="2 - Configurar un cliente móvil en el servidor WireGuard">2 - Configurar un cliente móvil en el servidor WireGuard</a>
</span>
<!--span class="number">
14
</span-->
<ul>
<li><span class="title">
<a href="#2.1---crear-las-claves-del-cliente" title="2.1 - Crear las claves del cliente">2.1 - Crear las claves del cliente</a>
</span>
<!--span class="number">
15
</span-->
</li>
<li><span class="title">
<a href="#2.2---crear-un-archivo-de-configuración-para-el-cliente" title="2.2 - Crear un archivo de configuración para el cliente">2.2 - Crear un archivo de configuración para el cliente</a>
</span>
<!--span class="number">
16
</span-->
</li>
<li><span class="title">
<a href="#2.3---permitir-el-acceso-al-cliente-en-el-servidor" title="2.3 - Permitir el acceso al cliente en el servidor">2.3 - Permitir el acceso al cliente en el servidor</a>
</span>
<!--span class="number">
17
</span-->
</li>
<li><span class="title">
<a href="#2.4---generar-un-código-qr-con-la-configuración" title="2.4 - Generar un código QR con la configuración">2.4 - Generar un código QR con la configuración</a>
</span>
<!--span class="number">
18
</span-->
</li>
<li><span class="title">
<a href="#2.5---instalar-la-app-cliente-de-wireguard" title="2.5 - Instalar la app cliente de WireGuard">2.5 - Instalar la app cliente de WireGuard</a>
</span>
<!--span class="number">
19
</span-->
</li>
<li><span class="title">
<a href="#2.6---configurar-el-cliente-vpn-en-ios" title="2.6 - Configurar el cliente VPN en iOS">2.6 - Configurar el cliente VPN en iOS</a>
</span>
<!--span class="number">
20
</span-->
</li>
<li><span class="title">
<a href="#2.7---configurar-el-cliente-vpn-en-android" title="2.7 - Configurar el cliente VPN en Android">2.7 - Configurar el cliente VPN en Android</a>
</span>
<!--span class="number">
21
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#3---configurar-un-cliente-de-escritorio-en-el-servidor-wireguard" title="3 - Configurar un cliente de escritorio en el servidor WireGuard">3 - Configurar un cliente de escritorio en el servidor WireGuard</a>
</span>
<!--span class="number">
22
</span-->
<ul>
<li><span class="title">
<a href="#3.1---macos-catalina" title="3.1 - macOS Catalina">3.1 - macOS Catalina</a>
</span>
<!--span class="number">
23
</span-->
</li>
<li><span class="title">
<a href="#3.2---windows-10" title="3.2 - Windows 10">3.2 - Windows 10</a>
</span>
<!--span class="number">
24
</span-->
</li>
<li><span class="title">
<a href="#3.3---ubuntu-desktop-20.04" title="3.3 - Ubuntu Desktop 20.04">3.3 - Ubuntu Desktop 20.04</a>
</span>
<!--span class="number">
25
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#4---probando-la-conexión-del-cliente" title="4 - Probando la conexión del cliente">4 - Probando la conexión del cliente</a>
</span>
<!--span class="number">
26
</span-->
</li>
<li><span class="title">
<a href="#5---créditos" title="5 - Créditos">5 - Créditos</a>
</span>
<!--span class="number">
27
</span-->
</li>
</ul>
</li>

</ul>
<p></p><h2 id="1---configurar-un-servidor-vpn-con-wireguard-en-ubuntu-server"><a name="1---configurar-un-servidor-vpn-con-wireguard-en-ubuntu-server" href="#1---configurar-un-servidor-vpn-con-wireguard-en-ubuntu-server"></a>1 - Configurar un servidor VPN con WireGuard en Ubuntu Server</h2><h3 id="1.1---actualización-del-servidor"><a name="1.1---actualización-del-servidor" href="#1.1---actualización-del-servidor"></a>1.1 - Actualización del servidor</h3><p>Es importante, antes de instalar cualquier paquete en un servidor, actualizar el sistema y los repositorios:</p><pre><code data-origin="<pre><code>sudo apt update &amp;amp;&amp;amp; sudo apt upgrade
</code></pre>">sudo apt update &amp;&amp; sudo apt upgrade
</code></pre><p>Es posible que la actualización requiera un reinicio del sistema, para comprobarlo, mostramos el contenido del archivo reboot-required:</p><pre><code data-origin="<pre><code>cat /var/run/reboot-required
</code></pre>">cat /var/run/reboot-required
</code></pre><p>Si aparece <code>*** System restart required ***</code>, es necesario reiniciar. Puedes hacerlo con el comando:</p><pre><code data-origin="<pre><code>sudo reboot
</code></pre>">sudo reboot
</code></pre><h3 id="1.2---instalar-ssh-para-acceder-remotamente-al-servidor-(opcional)"><a name="1.2---instalar-ssh-para-acceder-remotamente-al-servidor-(opcional)" href="#1.2---instalar-ssh-para-acceder-remotamente-al-servidor-(opcional)"></a>1.2 - Instalar SSH para acceder remotamente al servidor (opcional)</h3><pre><code data-origin="<pre><code>sudo apt install ssh
</code></pre>">sudo apt install ssh
</code></pre><p>Ahora ya podremos conectarnos al servidor desde una terminal de un cliente en la misma red, poniendo el siguiente comando:</p><pre><code data-origin="<pre><code>ssh [USUARIO]@[IP_SERVIDOR]
</code></pre>">ssh [USUARIO]@[IP_SERVIDOR]
</code></pre><p>Sustituyendo [USUARIO] por el nombre de usuario del servidor e [IP_SERVIDOR] por la IP. También puedes utilizar un software como <a href="https://www.putty.org/">Putty</a> para la conexión.</p><p>Si es la primera vez que te conectas, te preguntará si estás seguro de querer continuar, ya que la clave del servidor no se ha establecido como auténtica previamente:</p><pre><code data-origin="<pre><code>The authenticity of host '[IP__SERVIDOR] ([IP_SERVIDOR])' can't be established.
ECDSA key fingerprint is SHA256:[FINGERPRINT_SERVIDOR].
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre>">The authenticity of host '[IP__SERVIDOR] ([IP_SERVIDOR])' can't be established.
ECDSA key fingerprint is SHA256:[FINGERPRINT_SERVIDOR].
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre><p>Escribimos <code>yes</code> y nos pedirá la contraseña del usuario del servidor.</p><p>Ya podremos conectarnos cada vez que lo necesitemos.</p><h3 id="1.3---instalar-el-servidor-vpn-wireguard"><a name="1.3---instalar-el-servidor-vpn-wireguard" href="#1.3---instalar-el-servidor-vpn-wireguard"></a>1.3 - Instalar el servidor VPN WireGuard</h3><p>La instalación en esta versión es tan sencilla como ejecutar:</p><pre><code data-origin="<pre><code>sudo apt install wireguard
</code></pre>">sudo apt install wireguard
</code></pre><h3 id="1.4---generar-las-claves-del-servidor"><a name="1.4---generar-las-claves-del-servidor" href="#1.4---generar-las-claves-del-servidor"></a>1.4 - Generar las claves del servidor</h3><p>El servidor necesita una clave privada y otra pública para funcionar, así que vamos a generarlas.</p><p>Con el siguiente comando, creamos una carpeta en la que guardar las claves (la opción -p indica a mkdir que, si es necesario, cree todas las carpetas de la ruta que no existan):</p><pre><code data-origin="<pre><code>sudo mkdir -p /etc/wireguard/keys
</code></pre>">sudo mkdir -p /etc/wireguard/keys
</code></pre><p>Para generar una clave privada para WireGuard, se utiliza el comando:</p><pre><code data-origin="<pre><code>wg genkey
</code></pre>">wg genkey
</code></pre><p>Cada vez que lo ejecutes, se generará una diferente. Puedes copiar esa clave o directamente enviarla al archivo server.key con el comando:</p><pre><code data-origin="<pre><code>wg genkey &amp;gt; /etc/wireguard/keys/server.key
</code></pre>">wg genkey &gt; /etc/wireguard/keys/server.key
</code></pre><p>El comando <code>wg pubkey</code> recibe una clave privada por la entrada estándar y genera su clave pública asociada. Si queremos que genere una clave pública de la clave privada server.key que generamos previamente, podemos hacerlo con el comando:</p><pre><code data-origin="<pre><code>cat /etc/wireguard/keys/server.key | wg pubkey
</code></pre>">cat /etc/wireguard/keys/server.key | wg pubkey
</code></pre><p>Nos mostrará la clave pública por pantalla. En lugar de copiarla manualmente, podemos escribirla directamente en el archivo server.key.pub como hicimos previamente con la clave privada:</p><pre><code data-origin="<pre><code>cat /etc/wireguard/keys/server.key | wg pubkey &amp;gt; /etc/wireguard/keys/server.key.pub
</code></pre>">cat /etc/wireguard/keys/server.key | wg pubkey &gt; /etc/wireguard/keys/server.key.pub
</code></pre><p>Ya están las claves necesarias generadas. Podemos ver nuestra clave privada ejecutando el comando:</p><pre><code data-origin="<pre><code>sudo cat /etc/wireguard/keys/server.key
</code></pre>">sudo cat /etc/wireguard/keys/server.key
</code></pre><p>¡Recuerda no compartir nunca tu clave privada!</p><p>También podemos acceder a ver nuestra clave pública ejecutando:</p><pre><code data-origin="<pre><code>sudo cat /etc/wireguard/keys/server.key.pub
</code></pre>">sudo cat /etc/wireguard/keys/server.key.pub
</code></pre><h3 id="1.5---determinar-la-interfaz-predeterminada"><a name="1.5---determinar-la-interfaz-predeterminada" href="#1.5---determinar-la-interfaz-predeterminada"></a>1.5 - Determinar la interfaz predeterminada</h3><p>Es necesario conocer el nombre de la interfaz que estamos usando para acceder a Internet, ya que tendremos que escribirlo en la configuración. Si no sabes cuál es, el siguiente comando te lo revelará:</p><pre><code data-origin="<pre><code>ip -o -4 route show to default | awk '{print $5}'
</code></pre>">ip -o -4 route show to default | awk '{print $5}'
</code></pre><p>El nombre que a mí me muestra es <code>ens3</code>. Anota el tuyo.</p><h3 id="1.6---configurar-la-interfaz-para-wireguard"><a name="1.6---configurar-la-interfaz-para-wireguard" href="#1.6---configurar-la-interfaz-para-wireguard"></a>1.6 - Configurar la interfaz para WireGuard</h3><p>WireGuard funciona añadiendo una interfaz de red a nuestro servidor, que es la que utilizará el túnel VPN. La llamaremos <code>wg0</code>.</p><p>Creamos el archivo de configuración de la interfaz:</p><pre><code data-origin="<pre><code>sudo nano /etc/wireguard/wg0.conf
</code></pre>">sudo nano /etc/wireguard/wg0.conf
</code></pre><p>Con el siguiente contenido:</p><pre><code data-origin="<pre><code>[Interface]
Address = 10.0.0.1/24
ListenPort = 51820
PrivateKey = [CLAVE_PRIVADA_SERVIDOR]
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o [NOMBRE_INTERFAZ_INTERNET] -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o [NOMBRE_INTERFAZ_INTERNET] -j MASQUERADE
SaveConfig = true
</code></pre>">[Interface]
Address = 10.0.0.1/24
ListenPort = 51820
PrivateKey = [CLAVE_PRIVADA_SERVIDOR]
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o [NOMBRE_INTERFAZ_INTERNET] -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o [NOMBRE_INTERFAZ_INTERNET] -j MASQUERADE
SaveConfig = true
</code></pre><p>Sustituyendo [CLAVE_PRIVADA_SERVIDOR] por la clave privada que generamos anteriormente, guardada en el archivo server.key y [NOMBRE_INTERFAZ_INTERNET] por el nombre de la interfaz anotado en el paso anterior.</p><p>La IP que está escrita en la directiva Address puede ser cualquiera. Será la IP (y máscara de red) que tendrá configurada la interfaz wg0 para la conexión VPN. Los clientes VPN que conectemos posteriormente, deberán tener en la interfaz de túnel VPN que configuremos una IP de la misma red.</p><p>El puerto escrito en la directiva ListenPort será el puerto a través del cual escuchará el servicio de WireGuard en el servidor.</p><p>Por ejemplo, el contenido de mi archivo queda así:</p><pre><code data-origin="<pre><code>[Interface]
Address = 10.0.0.1/24
ListenPort = 51820
PrivateKey = SF5GNe5Afq2xHkb/Trq3/tdgfZIrHcDLCk6yojkCi2B=
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE
SaveConfig = true
</code></pre>">[Interface]
Address = 10.0.0.1/24
ListenPort = 51820
PrivateKey = SF5GNe5Afq2xHkb/Trq3/tdgfZIrHcDLCk6yojkCi2B=
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE
SaveConfig = true
</code></pre><p>Pulsamos <em>CTRL+X</em> para salir, escribiendo <code>Y</code> y pulsando la tecla <code>ENTER</code> para guardar los cambios.</p><h3 id="1.7---establecer-los-permisos-de-acceso-a-la-clave-privada-y-a-la-configuración"><a name="1.7---establecer-los-permisos-de-acceso-a-la-clave-privada-y-a-la-configuración" href="#1.7---establecer-los-permisos-de-acceso-a-la-clave-privada-y-a-la-configuración"></a>1.7 - Establecer los permisos de acceso a la clave privada y a la configuración</h3><p>Debemos asegurarnos que solamente el usuario administrador pueda acceder a la clave privada. Como está escrita en el archivo server.key y en el archivo wg0.conf, les daremos los permisos necesarios para que solo sean accesibles por ese usuario:</p><pre><code data-origin="<pre><code>sudo chmod 600 /etc/wireguard/wg0.conf /etc/wireguard/keys/server.key
</code></pre>">sudo chmod 600 /etc/wireguard/wg0.conf /etc/wireguard/keys/server.key
</code></pre><h3 id="1.8---encender-la-interfaz-de-wireguard"><a name="1.8---encender-la-interfaz-de-wireguard" href="#1.8---encender-la-interfaz-de-wireguard"></a>1.8 - Encender la interfaz de WireGuard</h3><p>Con el siguiente comando levantamos la interfaz <code>wg0</code> recién creada:</p><pre><code data-origin="<pre><code>sudo wg-quick up wg0
</code></pre>">sudo wg-quick up wg0
</code></pre><p>Tendrás una salida similar a la siguiente:</p><pre><code data-origin="<pre><code>[#] ip link add wg0 type wireguard
[#] wg setconf wg0 /dev/fd/63
[#] ip -4 address add 10.0.0.1/24 dev wg0
[#] ip link set mtu 1420 up dev wg0
[#] iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
</code></pre>">[#] ip link add wg0 type wireguard
[#] wg setconf wg0 /dev/fd/63
[#] ip -4 address add 10.0.0.1/24 dev wg0
[#] ip link set mtu 1420 up dev wg0
[#] iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
</code></pre><p>Podemos comprobar el estado de la interfaz con el siguiente comando:</p><pre><code data-origin="<pre><code>sudo wg show wg0
</code></pre>">sudo wg show wg0
</code></pre><p>Aparecerá algo similar a lo siguiente:</p><pre><code data-origin="<pre><code>interface: wg0
  public key: LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
  private key: (hidden)
  listening port: 51820
</code></pre>">interface: wg0
  public key: LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
  private key: (hidden)
  listening port: 51820
</code></pre><h3 id="1.9---iniciar-la-interfaz-de-wireguard-automáticamente-al-arrancar"><a name="1.9---iniciar-la-interfaz-de-wireguard-automáticamente-al-arrancar" href="#1.9---iniciar-la-interfaz-de-wireguard-automáticamente-al-arrancar"></a>1.9 - Iniciar la interfaz de WireGuard automáticamente al arrancar</h3><p>Con el siguiente comando configuramos que se inicie la interfaz de WireGuard cada vez que se encienda el servidor:</p><pre><code data-origin="<pre><code>sudo systemctl enable wg-quick@wg0
</code></pre>">sudo systemctl enable wg-quick@wg0
</code></pre><h3 id="1.10---configurando-el-tráfico-de-red-y-el-cortafuegos"><a name="1.10---configurando-el-tráfico-de-red-y-el-cortafuegos" href="#1.10---configurando-el-tráfico-de-red-y-el-cortafuegos"></a>1.10 - Configurando el tráfico de red y el cortafuegos</h3><h4 id="1.10.1---permitir-el-reenvío-de-tráfico"><a name="1.10.1---permitir-el-reenvío-de-tráfico" href="#1.10.1---permitir-el-reenvío-de-tráfico"></a>1.10.1 - Permitir el reenvío de tráfico</h4><p>Para que WireGuard pueda reenviar los paquetes entre interfaces, es necesario activar la opción. Para ello, abrimos el archivo sysctl.conf:</p><pre><code data-origin="<pre><code>sudo nano /etc/sysctl.conf
</code></pre>">sudo nano /etc/sysctl.conf
</code></pre><p>Tenemos que buscar la línea <code>net.ipv4.ip_forward=1</code> y descomentarla, es decir, borrar la almohadilla (#) que tiene delante. Guardamos el archivo y aplicamos los cambios ejecutando:</p><pre><code data-origin="<pre><code>sudo sysctl -p
</code></pre>">sudo sysctl -p
</code></pre><h4 id="1.10.2---abrir-el-puerto-de-wireguard-y-activar-el-cortafuegos-(opcional)"><a name="1.10.2---abrir-el-puerto-de-wireguard-y-activar-el-cortafuegos-(opcional)" href="#1.10.2---abrir-el-puerto-de-wireguard-y-activar-el-cortafuegos-(opcional)"></a>1.10.2 - Abrir el puerto de WireGuard y activar el cortafuegos (opcional)</h4><p>Si no tienes el cortafuegos por defecto activado en el servidor, no es necesario que realices estos pasos. Sin embargo, es recomendable abrir solamente los puertos que vayan a utilizarse por seguridad.</p><p>Para abrir el puerto de escucha para WireGuard que configuramos, ejecutamos:</p><pre><code data-origin="<pre><code>sudo ufw allow 51820/udp
</code></pre>">sudo ufw allow 51820/udp
</code></pre><p>Si estamos accediendo por SSH, que no se nos olvide abrir también el puerto que estemos utilizando, o perderemos la conexión. Por defecto es el puerto 22:</p><pre><code data-origin="<pre><code>sudo ufw allow 22/tcp
</code></pre>">sudo ufw allow 22/tcp
</code></pre><p>Una vez aplicadas las reglas, ya podemos activar el cortafuegos:</p><pre><code data-origin="<pre><code>sudo ufw enable
</code></pre>">sudo ufw enable
</code></pre><p>Podemos comprobar que está funcionando con las reglas correctas ejecutando el comando:</p><pre><code data-origin="<pre><code>sudo ufw status verbose
</code></pre>">sudo ufw status verbose
</code></pre><p>Recuerda que si en la red local del servidor hay otros cortafuegos en la ruta de acceso a Internet, también tendrás que abrir el puerto de escucha de WireGuard en ellos. De la misma forma, recuerda que en el caso de que el servidor no tenga una IP pública, configurar el reenvío de puerto necesario.</p><h3 id="1.11---añadiendo-clientes"><a name="1.11---añadiendo-clientes" href="#1.11---añadiendo-clientes"></a>1.11 - Añadiendo clientes</h3><p>Ya tenemos el servidor preparado para funcionar. Solamente falta añadir los clientes que queramos conectar. Si ya sabes la clave pública de un cliente al que quieres permitir la conexión y la IP que deseas proporcionarle, en el servidor solamente tendrías que ejecutar el siguiente comando:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer [CLAVE_PUBLICA_CLIENTE] allowed-ips [IP_CLIENTE_VPN]
</code></pre>">sudo wg set wg0 peer [CLAVE_PUBLICA_CLIENTE] allowed-ips [IP_CLIENTE_VPN]
</code></pre><p>Sustituyendo [CLAVE_PUBLICA_CLIENTE] por la clave pública del cliente y [IP_CLIENTE_VPN] por la IP que deseas proporcionarle en la conexión VPN. Recuerda que debe pertenecer a la misma red que la IP que le pusiste al servidor en la directiva Address de la configuración.</p><p>¿No sabes cuál es la clave pública de tu cliente? No te preocupes, en los siguientes apartados veremos cómo hacer la conexión paso a paso en un cliente móvil (Android/iOS) o en un cliente de escritorio (Windows/macOS/Ubuntu Desktop).</p><h2 id="2---configurar-un-cliente-móvil-en-el-servidor-wireguard"><a name="2---configurar-un-cliente-móvil-en-el-servidor-wireguard" href="#2---configurar-un-cliente-móvil-en-el-servidor-wireguard"></a>2 - Configurar un cliente móvil en el servidor WireGuard</h2><h3 id="2.1---crear-las-claves-del-cliente"><a name="2.1---crear-las-claves-del-cliente" href="#2.1---crear-las-claves-del-cliente"></a>2.1 - Crear las claves del cliente</h3><p>Al contrario de lo que sucede en un sistema de escritorio como macOS o Windows, en el caso de iOS y Android no se nos suministran las claves del cliente, por lo que tendremos que generarla nosotros mismos en el servidor.</p><p>Las claves de los clientes puedes almacenarlas en cualquier directorio. En nuestro caso, lo haremos en /etc/wireguard/clients. Si no existe previamente, tendremos que crearlo:</p><pre><code data-origin="<pre><code>sudo mkdir -p /etc/wireguard/clients
</code></pre>">sudo mkdir -p /etc/wireguard/clients
</code></pre><p>A continuación, generaremos las claves exactamente de la misma forma que hicimos para generar las del servidor. Les pondremos el nombre que queramos (lo ideal es que te sirva para identificar al cliente). En este caso pondremos de nombre mobile.</p><p>Necesitamos acceder al usuario root para realizar cambios en esa carpeta, para eso ejecutamos:</p><pre><code data-origin="<pre><code>sudo su
</code></pre>">sudo su
</code></pre><p>Generamos la clave privada:</p><pre><code data-origin="<pre><code>wg genkey &amp;gt; /etc/wireguard/clients/mobile.key
</code></pre>">wg genkey &gt; /etc/wireguard/clients/mobile.key
</code></pre><p>Y la pública:</p><pre><code data-origin="<pre><code>cat /etc/wireguard/clients/mobile.key | wg pubkey &amp;gt; /etc/wireguard/clients/mobile.key.pub
</code></pre>">cat /etc/wireguard/clients/mobile.key | wg pubkey &gt; /etc/wireguard/clients/mobile.key.pub
</code></pre><p>Podemos salir del usuario root ejecutando:</p><pre><code data-origin="<pre><code>exit
</code></pre>">exit
</code></pre><p>Ya están las claves del cliente generadas. Podemos ver la clave privada del cliente ejecutando el comando:</p><pre><code data-origin="<pre><code>sudo cat /etc/wireguard/clients/mobile.key
</code></pre>">sudo cat /etc/wireguard/clients/mobile.key
</code></pre><p>¡Recuerda no compartir nunca tu clave privada!</p><p>También podemos ver la clave pública del cliente ejecutando:</p><pre><code data-origin="<pre><code>sudo cat /etc/wireguard/clients/mobile.key.pub
</code></pre>">sudo cat /etc/wireguard/clients/mobile.key.pub
</code></pre><p>Anota la clave privada porque será necesaria para el archivo de configuración del cliente.</p><h3 id="2.2---crear-un-archivo-de-configuración-para-el-cliente"><a name="2.2---crear-un-archivo-de-configuración-para-el-cliente" href="#2.2---crear-un-archivo-de-configuración-para-el-cliente"></a>2.2 - Crear un archivo de configuración para el cliente</h3><p>Crearemos el archivo mobile.conf:</p><pre><code data-origin="<pre><code>sudo nano /etc/wireguard/clients/mobile.conf
</code></pre>">sudo nano /etc/wireguard/clients/mobile.conf
</code></pre><p>Y le ponemos el siguiente contenido:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = [CLAVE_PRIVADA_CLIENTE]
Address = [IP_VPN_CLIENTE]/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = [CLAVE_PÚBLICA_SERVIDOR]
AllowedIPs = 0.0.0.0/0
Endpoint = [IP_PÚBLICA_SERVIDOR]:51820
</code></pre>">[Interface]
PrivateKey = [CLAVE_PRIVADA_CLIENTE]
Address = [IP_VPN_CLIENTE]/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = [CLAVE_PÚBLICA_SERVIDOR]
AllowedIPs = 0.0.0.0/0
Endpoint = [IP_PÚBLICA_SERVIDOR]:51820
</code></pre><p>Sustituyendo [CLAVE_PRIVADA_CLIENTE] por la clave privada del cliente que hemos generado en el paso anterior y almacenado en mobile.key, [IP_VPN_CLIENTE] por la IP que le queramos poner al cliente en la red VPN, [CLAVE_PÚBLICA_SERVIDOR] por la clave pública del servidor que guardamos en server.key.pub y [IP_PÚBLICA_SERVIDOR] por la IP pública del servidor en la WAN.</p><p>Por ejemplo, mi archivo queda así:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = qNHXjj5J8t4mVzi0GLsTosAGA8j4wjAIdQQ1W/Zna2a=
Address = 10.0.0.2/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre>">[Interface]
PrivateKey = qNHXjj5J8t4mVzi0GLsTosAGA8j4wjAIdQQ1W/Zna2a=
Address = 10.0.0.2/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre><p>Ten en cuenta que puedes cambiar los servidores DNS por los que quieras que use el cliente. También puedes añadir más seguridad permitiendo solamente a determinadas IPs que puedan conectarse al servidor con esta configuración en la directiva AllowedIPs. En este caso he dejado que cualquier IP pueda hacerlo.</p><h3 id="2.3---permitir-el-acceso-al-cliente-en-el-servidor"><a name="2.3---permitir-el-acceso-al-cliente-en-el-servidor" href="#2.3---permitir-el-acceso-al-cliente-en-el-servidor"></a>2.3 - Permitir el acceso al cliente en el servidor</h3><p>Ahora que ya tienes clara la clave pública y la IP que se le va a asignar al cliente, puedes ejecutar el comando que vimos en el apartado <a href="#añadiendo-clientes">Añadiendo clientes</a> para permitir la conexión al servidor:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer [CLAVE_PUBLICA_CLIENTE] allowed-ips [IP_CLIENTE_VPN]
</code></pre>">sudo wg set wg0 peer [CLAVE_PUBLICA_CLIENTE] allowed-ips [IP_CLIENTE_VPN]
</code></pre><p>Sustituyendo [CLAVE_PUBLICA_CLIENTE] por la clave pública del cliente (archivo mobile.key.pub) y [IP_CLIENTE_VPN] por la IP que deseas proporcionarle en la conexión VPN. </p><p>En mi caso quedaría así:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer qtAufkgUm3kmISt3ZpV4kg7Jie9PGRlug/WoBl/TsG7= allowed-ips 10.0.0.2
</code></pre>">sudo wg set wg0 peer qtAufkgUm3kmISt3ZpV4kg7Jie9PGRlug/WoBl/TsG7= allowed-ips 10.0.0.2
</code></pre><h3 id="2.4---generar-un-código-qr-con-la-configuración"><a name="2.4---generar-un-código-qr-con-la-configuración" href="#2.4---generar-un-código-qr-con-la-configuración"></a>2.4 - Generar un código QR con la configuración</h3><p>Sería suficiente con pasar el archivo mobile.conf a la app WireGuard del cliente, pero es más sencillo generar un QR con el contenido del archivo para no tener que pasarlo manualmente al móvil.</p><p>Para ello necesitaremos instalar el siguiente paquete:</p><pre><code data-origin="<pre><code>sudo apt install qrencode
</code></pre>">sudo apt install qrencode
</code></pre><p>Necesitamos acceder al usuario root de nuevo para realizar el QR del archivo, para eso ejecutamos:</p><pre><code data-origin="<pre><code>sudo su
</code></pre>">sudo su
</code></pre><p>Y con el siguiente comando generamos el código QR del archivo mobile.conf:</p><pre><code data-origin="<pre><code>qrencode -t ansiutf8 &amp;lt; /etc/wireguard/clients/mobile.conf
</code></pre>">qrencode -t ansiutf8 &lt; /etc/wireguard/clients/mobile.conf
</code></pre><p>Ahora ya podremos coger el móvil con el que queramos conectarnos al servidor.</p><h3 id="2.5---instalar-la-app-cliente-de-wireguard"><a name="2.5---instalar-la-app-cliente-de-wireguard" href="#2.5---instalar-la-app-cliente-de-wireguard"></a>2.5 - Instalar la app cliente de WireGuard</h3><p>La app de WireGuard está disponible tanto en la <a href="https://play.google.com/store/apps/details?id=com.wireguard.android&amp;hl=es&amp;gl=US">Play Store</a> para Android, como en la <a href="https://apps.apple.com/es/app/wireguard/id1441195209">App Store</a> para iOS (y iPadOS). Así que solamente tienes que buscarla o pulsar en los enlaces y descargarla.</p><h3 id="2.6---configurar-el-cliente-vpn-en-ios"><a name="2.6---configurar-el-cliente-vpn-en-ios" href="#2.6---configurar-el-cliente-vpn-en-ios"></a>2.6 - Configurar el cliente VPN en iOS</h3><p>Primero abrimos la app <strong>WireGuard</strong>.</p><p><img src="images/ios1.jpg" alt="Captura de la app WireGuard en la App Store" width="300"></p><p>Pulsamos en <strong>Agregar un túnel</strong>.</p><p><img src="images/ios2.jpg" alt="Captura de la pantalla principal de la app WireGuard" width="300"></p><p>A continuación elegimos <strong>Crear desde código QR</strong>.</p><p><img src="images/ios3.jpg" alt="Captura de la pantalla agregando un túnel de la app WireGuard" width="300"></p><p><strong>Escaneamos el código QR</strong> con la cámara y le ponemos <strong>un nombre cualquiera</strong> al túnel.</p><p><img src="images/ios4.jpg" alt="Captura de la pantalla escaneando un código QR de la app WireGuard" width="300"></p><p>El sistema nos pedirá <strong>permiso</strong> para añadir y activar la configuración VPN.</p><p><img src="images/ios5.jpg" alt="Captura de la pantalla solicitando permisos en la app WireGuard" width="300"></p><p>Por último, <strong>activamos la configuración añadida</strong> y veremos como aparece la palabra VPN en la información susperior del sistema, indicando que estamos conectados a Internet a través del servidor configurado.</p><p><img src="images/ios6.jpg" alt="Captura de la pantalla principal de la app WireGuard con el túnel activado" width="300"></p><p>Puedes ver cómo comprobar que estamos conectados correctamente a la red local del servidor en el apartado <a href="#probando-la-conexión-del-cliente">Probando la conexión del cliente</a>.</p><h3 id="2.7---configurar-el-cliente-vpn-en-android"><a name="2.7---configurar-el-cliente-vpn-en-android" href="#2.7---configurar-el-cliente-vpn-en-android"></a>2.7 - Configurar el cliente VPN en Android</h3><p>Primero abrimos la app <strong>WireGuard</strong>.</p><p><img src="images/android1.png" alt="Captura de la app WireGuard en la Play Store" width="300"></p><p>Pulsamos en el <strong>icono +</strong> en azul para añadir una nueva configuración de túnel.</p><p><img src="images/android2.png" alt="Captura de la pantalla principal de la app WireGuard en Android" width="300"></p><p>Elegimos la opción <strong>Escanear desde código QR</strong>.</p><p><img src="images/android3.png" alt="Captura de la pantalla agregando un túnel de la app WireGuard" width="300"></p><p>Damos los <strong>permisos necesarios</strong> a la app para acceder a la cámara.</p><p><img src="images/android4.png" alt="Captura de los permisos para acceder a la cámara en la app WireGuard" width="300"></p><p><strong>Escaneamos el código QR</strong> y le ponemos <strong>un nombre cualquiera</strong> a la configuración del túnel.</p><p><img src="images/android5.png" alt="Captura de la pantalla agregando un túnel de la app WireGuard" width="300"></p><p><strong>Pulsamos en el slider</strong> para activar la configuración VPN que acabamos de añadir y <strong>aceptamos la solicitud de conexión</strong> del sistema Android.</p><p><img src="images/android6.png" alt="Captura de la solicitud de conexión en la app WireGuard" width="300"></p><p><strong>El túnel estará activado</strong> y en la parte superior aparecerá el icono de una llave para indicarlo.</p><p><img src="images/android7.png" alt="Captura de la pantalla principal de la app WireGuard con el túnel activado" width="300"></p><p>Puedes ver cómo comprobar que estamos conectados correctamente a la red local del servidor en el apartado <a href="#probando-la-conexión-del-cliente">Probando la conexión del cliente</a>.</p><h2 id="3---configurar-un-cliente-de-escritorio-en-el-servidor-wireguard"><a name="3---configurar-un-cliente-de-escritorio-en-el-servidor-wireguard" href="#3---configurar-un-cliente-de-escritorio-en-el-servidor-wireguard"></a>3 - Configurar un cliente de escritorio en el servidor WireGuard</h2><h3 id="3.1---macos-catalina"><a name="3.1---macos-catalina" href="#3.1---macos-catalina"></a>3.1 - macOS Catalina</h3><p>Primero accedemos a la App Store y descargamos la aplicación Wireguard.</p><p><img src="images/macos1.png" alt="Captura de la app WireGuard en la App Store" width="450"></p><p>Una vez instalada, la abrimos y pulsamos en el icono + para elegir Add Empty Tunnel… Nos permitirá configurar un nuevo túnel VPN.</p><p><img src="images/macos2.png" alt="Captura de la pantalla principal de la app WireGuard creando un nuevo túnel" width="450"></p><p>Nos generará automáticamente la clave pública y la clave privada del cliente. Apunta la clave pública porque te hará falta en el último paso para permitir el acceso de este cliente en el servidor. Le ponemos el nombre que queramos. También podemos marcar que la VPN se active automáticamente cuando estemos conectados mediante Ethernet, Wi-Fi o ambos.</p><p><img src="images/macos3.png" alt="Captura de la pantalla añadiendo un nuevo túnel en la app WireGuard" width="450"></p><p>Dentro del apartado Interface añadimos la directiva Address con la IP que queremos asignar al cliente (10.0.0.3/24 en nuestro esquema) y la directiva DNS, en la que indicaremos los servidores DNS que queremos utilizar cuando tengamos el túnel activado.</p><p>Escribimos un nuevo apartado Peer en el que indicaremos tres directivas:</p><ul>
<li>PublicKey, la clave pública del servidor.</li><li>AllowedIPs, IPs permitidas para el servidor, podemos dejar 0.0.0.0/0 para todas.</li><li>Endpoint, donde indicamos la IP pública del servidor y el puerto.</li></ul><p>En mi caso, el texto queda así:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = wEyjkOyB0LsPLYdoOL6u7X8OXxXsK1Om0FKwt5d3Clk=
Address = 10.0.0.3/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre>">[Interface]
PrivateKey = wEyjkOyB0LsPLYdoOL6u7X8OXxXsK1Om0FKwt5d3Clk=
Address = 10.0.0.3/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre><p><img src="images/macos4.png" alt="Captura de la pantalla añadiendo un nuevo túnel con la configuración apropiada en la app WireGuard" width="450"></p><p>Pulsamos en  Guardar y el sistema nos pedirá permiso para añadir la configuración VPN. Le damos a Permitir.</p><p><img src="images/macos5.png" alt="Captura de la ventana del sistema solicitando que el usuario permita a WireGuard añadir una configuración VPN" width="300"></p><p>Ya podremos activar el túnel, se marcará con un círculo verde cuando esté activo.</p><p><img src="images/macos6.png" alt="Captura de la pantalla principal de la app WireGuard con el túnel activado" width="300"></p><p>En la barra superior del sistema también aparecerá el icono de WireGuard, y podrás activar y desactivar el túnel VPN desde ahí.</p><p><img src="images/macos7.png" alt="Captura de la app WireGuard en la barra superior del sistema, permitiendo desactivar y activar el túnel" width="300"></p><p>Sin embargo, la conexión no funcionará hasta que no agreguemos el cliente en el servidor. Para ello, ejecutamos el siguiente comando en el servidor:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre>">sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre><p>En mi caso sería:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer 7W3cv39FVp26xcxdPz4FuSvCPzovONkolTErJvMEQCY= allowed-ips 10.0.0.3
</code></pre>">sudo wg set wg0 peer 7W3cv39FVp26xcxdPz4FuSvCPzovONkolTErJvMEQCY= allowed-ips 10.0.0.3
</code></pre><p>Puedes ver cómo comprobar que estamos conectados correctamente a la red local del servidor en el apartado <a href="#probando-la-conexión-del-cliente">Probando la conexión del cliente</a>.</p><h3 id="3.2---windows-10"><a name="3.2---windows-10" href="#3.2---windows-10"></a>3.2 - Windows 10</h3><p>Primero descargamos el instalador de WireGuard de la página <a href="https://www.wireguard.com/install/"></a><a href="https://www.wireguard.com/install/">https://www.wireguard.com/install/</a> y lo ejecutamos para instalar la aplicación.</p><p><img src="images/windows1.png" alt="Captura de la página web de descarga de WireGuard para Windows" width="400"></p><p>Se nos abrirá al concluir la instalación y pulsamos en el botón Add Tunnel.</p><p><img src="images/windows2.png" alt="Captura de la pantalla principal de la app WireGuard" width="450"></p><p>Elegimos la opción Add empty tunnel…</p><p><img src="images/windows3.png" alt="Captura seleccionando la opción de añadir un nuevo túnel en WireGuard" width="450"></p><p>Nos generará automáticamente la clave pública y la clave privada del cliente. Apunta la clave pública porque te hará falta en el último paso para permitir el acceso de este cliente en el servidor. Le ponemos el nombre que queramos.</p><p><img src="images/windows4.png" alt="Captura creando un nuevo túnel en WireGuard" width="450"></p><p>Dentro del apartado Interface añadimos la directiva Address con la IP que queremos asignar al cliente (10.0.0.3/24 en nuestro esquema) y la directiva DNS, en la que indicaremos los servidores DNS que queremos utilizar cuando tengamos el túnel activado.</p><p>Escribimos un nuevo apartado Peer en el que indicaremos tres directivas:</p><ul>
<li>PublicKey, la clave pública del servidor.</li><li>AllowedIPs, IPs permitidas para el servidor, podemos dejar 0.0.0.0/0 para todas.</li><li>Endpoint, donde indicamos la IP pública del servidor y el puerto.</li></ul><p>En mi caso, el texto queda así:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = AEG4c7jJ2L3+IcjsUT9jfjkkGXuJD4vl+As/vAHUz3g=
Address = 10.0.0.3/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre>">[Interface]
PrivateKey = AEG4c7jJ2L3+IcjsUT9jfjkkGXuJD4vl+As/vAHUz3g=
Address = 10.0.0.3/24
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre><p><img src="images/windows5.png" alt="Captura creando un nuevo túnel en WireGuard con la configuración adecuada" width="400"></p><p>Pulsamos en Save y el túnel estará creado sin activar.</p><p><img src="images/windows6.png" alt="Captura de la pantalla principal de la app WireGuard con el túnel desactivado" width="400"></p><p>Si le damos a Activate, se activará mostrando un tick verde.</p><p><img src="images/windows7.png" alt="Captura de la pantalla principal de la app WireGuard con el túnel activado" width="400"></p><p>En la barra de herramientas inferior también aparecerá el icono de WireGuard, y podrás activar y desactivar el túnel VPN desde ahí.</p><p><img src="images/windows8.png" alt="Captura de las opciones de WireGuard en la barra de herramientas" width="300"></p><p>Sin embargo, la conexión no funcionará hasta que no agreguemos el cliente en el servidor. Para ello, ejecutamos el siguiente comando en el servidor:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre>">sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre><p>En mi caso sería:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer 9XhACgL8ZPqKYJuCsKyFEt2nxT3NYki+glRZmMoFiyE= allowed-ips 10.0.0.3
</code></pre>">sudo wg set wg0 peer 9XhACgL8ZPqKYJuCsKyFEt2nxT3NYki+glRZmMoFiyE= allowed-ips 10.0.0.3
</code></pre><h3 id="3.3---ubuntu-desktop-20.04"><a name="3.3---ubuntu-desktop-20.04" href="#3.3---ubuntu-desktop-20.04"></a>3.3 - Ubuntu Desktop 20.04</h3><p>El procedimiento de instalación y configuración del cliente en Ubuntu Desktop es bastante similar al servidor. Tendremos que hacerlo desde una Terminal.</p><p>Primero actualizamos el repositorio de paquetes ejecutando:</p><pre><code data-origin="<pre><code>sudo apt-get update
</code></pre>">sudo apt-get update
</code></pre><p>Luego instalamos el paquete wireguard ejecutando:</p><pre><code data-origin="<pre><code>sudo apt-get install wireguard
</code></pre>">sudo apt-get install wireguard
</code></pre><p>A continuación, entramos en el usuario root para evitar problemas de permisos:</p><pre><code data-origin="<pre><code>sudo su
</code></pre>">sudo su
</code></pre><p>Creamos la carpeta para almacenar las claves, cambiamos los permisos por defecto de los archivos con umask para mayor seguridad y generamos la clave pública y privada. Tal y como hicimos en el servidor:</p><pre><code data-origin="<pre><code>mkdir -p /etc/wireguard/keys
umask 077
wg genkey &amp;gt; /etc/wireguard/keys/client.key
cat /etc/wireguard/keys/client.key | wg pubkey &amp;gt; /etc/wireguard/keys/client.key.pub
</code></pre>">mkdir -p /etc/wireguard/keys
umask 077
wg genkey &gt; /etc/wireguard/keys/client.key
cat /etc/wireguard/keys/client.key | wg pubkey &gt; /etc/wireguard/keys/client.key.pub
</code></pre><p>Ejecutando los siguientes comandos, podrás ver la clave privada y la clave pública generadas. Anótalas:</p><pre><code data-origin="<pre><code>cat /etc/wireguard/keys/client.key
cat /etc/wireguard/keys/client.key.pub
</code></pre>">cat /etc/wireguard/keys/client.key
cat /etc/wireguard/keys/client.key.pub
</code></pre><p>Ya podremos salir de la sesión del usuario root:</p><pre><code data-origin="<pre><code>exit
</code></pre>">exit
</code></pre><p>Ahora creamos y editamos el archivo /etc/wireguard/wg0.conf para configurar la interfaz:</p><pre><code data-origin="<pre><code>sudo nano /etc/wireguard/wg0.conf
</code></pre>">sudo nano /etc/wireguard/wg0.conf
</code></pre><p>Lo rellenamos con el siguiente contenido:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = [CLAVE_PRIVADA_CLIENTE]
Address = 10.0.0.3/24

[Peer]
PublicKey = [CLAVE_PUBLICA_SERVIDOR]
AllowedIPs = 0.0.0.0/0
Endpoint = [IP_PÚBLICA_SERVIDOR]:51820
</code></pre>">[Interface]
PrivateKey = [CLAVE_PRIVADA_CLIENTE]
Address = 10.0.0.3/24

[Peer]
PublicKey = [CLAVE_PUBLICA_SERVIDOR]
AllowedIPs = 0.0.0.0/0
Endpoint = [IP_PÚBLICA_SERVIDOR]:51820
</code></pre><p>Sustituyendo [CLAVE_PRIVADA_CLIENTE] por la clave privada que hemos generado en el archivo client.key, [CLAVE_PUBLICA_SERVIDOR] por la clave pública del servidor (almacenada en el archivo server.key.pub del mismo) y [IP_PÚBLICA_SERVIDOR] por la IP pública del servidor.</p><p>En mi caso, quedaría así:</p><pre><code data-origin="<pre><code>[Interface]
PrivateKey = MGRnwmF3xUSeQ4RjFf2GGrvtlkJ5AHu5uPrI2P++WXY=
Address = 10.0.0.3/24

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre>">[Interface]
PrivateKey = MGRnwmF3xUSeQ4RjFf2GGrvtlkJ5AHu5uPrI2P++WXY=
Address = 10.0.0.3/24

[Peer]
PublicKey = LawXXhHpW3l8KhEklkg5WGaEsEVpmxqmazWusk7A9SU=
AllowedIPs = 0.0.0.0/0
Endpoint = 83.59.218.164:51820
</code></pre><p>A continuación, podemos habilitar la interfaz para que se inicie cada vez que arranque el sistema:</p><pre><code data-origin="<pre><code>sudo systemctl enable wg-quick@wg0.service
</code></pre>">sudo systemctl enable wg-quick@wg0.service
</code></pre><p>Si queremos levantarla sin reiniciar, podemos hacerlo manualmente con el comando:</p><pre><code data-origin="<pre><code>sudo systemctl start wg-quick@wg0.service
</code></pre>">sudo systemctl start wg-quick@wg0.service
</code></pre><p>Podemos comprobar que está activo el túnel con el comando:</p><pre><code data-origin="<pre><code>sudo wg
</code></pre>">sudo wg
</code></pre><p>Sin embargo, la conexión no funcionará hasta que no agreguemos el cliente en el servidor. Para ello, ejecutamos el siguiente comando en el servidor:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre>">sudo wg set wg0 peer [CLAVE_PÚBLICA_CLIENTE] allowed-ips [IP_CLIENTE]
</code></pre><p>En mi caso sería:</p><pre><code data-origin="<pre><code>sudo wg set wg0 peer va0V/c+CwCNLfSUHMNGQi3Vqj6ZGjhj+h116YRabc08= allowed-ips 10.0.0.3
</code></pre>">sudo wg set wg0 peer va0V/c+CwCNLfSUHMNGQi3Vqj6ZGjhj+h116YRabc08= allowed-ips 10.0.0.3
</code></pre><p>Puedes ver cómo comprobar que estamos conectados correctamente a la red local del servidor en el apartado <a href="#probando-la-conexión-del-cliente">Probando la conexión del cliente</a>.</p><h2 id="4---probando-la-conexión-del-cliente"><a name="4---probando-la-conexión-del-cliente" href="#4---probando-la-conexión-del-cliente"></a>4 - Probando la conexión del cliente</h2><p>Podemos comprobar la conexión de varias formas. En el servidor, una vez establecida la conexión con un cliente, al ejecutar el comando:</p><pre><code data-origin="<pre><code>sudo wg
</code></pre>">sudo wg
</code></pre><p>Dentro del apartado <strong>peer</strong> con la clave pública del cliente que estemos comprobando, veremos la línea <strong>latest handshake</strong> indicando el tiempo que hace desde que se completó la conexión con éxito.</p><p>En el cliente también podemos comprobar la conexión simplemente haciendo ping a la IP del servidor dentro del túnel VPN. En nuestro ejemplo:</p><pre><code data-origin="<pre><code>ping 10.0.0.1
</code></pre>">ping 10.0.0.1
</code></pre><p>Ten en cuenta que este túnel permite que el cliente acceda a Internet a través del servidor, por lo que si miramos nuestra IP pública en páginas como <a href="https://www.cualesmiip.com">www.cualesmiip.com</a>, veremos que cuando tenemos la conexión VPN activada coincide con la IP pública del servidor.</p><p>Y otra consecuencia importante es que el cliente pasa a estar virtualmente en la misma red local que el servidor. Eso significa que puede acceder a cualquier otro servidor local. Si en la red del servidor tienes otro con una web por ejemplo, podrías acceder a la misma usando un navegador en el cliente y su IP privada. Si en cualquiera de esos servidores hay instalado un servicio SSH, podrías acceder a controlarlos con un cliente SSH usando sus IPs privadas y sin necesidad de que tengan puertos expuestos en la red pública. Incluso podrías configurar el router que proporciona Internet al servidor VPN poniendo su IP privada en un navegador del cliente, mientras esté accesible desde cualquier IP de la red local.</p><p>En resumen, a nivel práctico es como si tuvieras el cliente conectado directamente a la misma red local que el servidor, pero sin estar físicamente en la misma.</p><h2 id="5---créditos"><a name="5---créditos" href="#5---créditos"></a>5 - Créditos</h2><p>El guión de esta práctica está basado en el curso realizado por Ray Rogers en la web de ServerSide UP: <a href="https://serversideup.net/courses/gain-flexibility-and-increase-privacy-with-wireguard-vpn/"></a><a href="https://serversideup.net/courses/gain-flexibility-and-increase-privacy-with-wireguard-vpn/">https://serversideup.net/courses/gain-flexibility-and-increase-privacy-with-wireguard-vpn/</a></p><p>Esta traducción parcial y adaptación se ha realizado con su permiso expreso sin ánimo de lucro.</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
